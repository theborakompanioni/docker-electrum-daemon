services:
  electrum:
    build:
      context: .
      args:
        - ELECTRUM_VERSION=${ELECTRUM_VERSION}
        - ELECTRUM_CHECKSUM_SHA512=${ELECTRUM_CHECKSUM_SHA512}
    container_name: electrum
    ports:
      - 127.0.0.1:7000:17000
    environment:
      - DRY_RUN=${DRY_RUN:-false}
      - ELECTRUM_NETWORK=regtest
      - ELECTRUM_RPCUSER=electrum
      - ELECTRUM_RPCPASSWORD=changeme
      - ELECTRUM_RPCPORT=17000
      - ELECTRUM_CONFIG_ONESERVER=true
      - ELECTRUM_CONFIG_SERVER=127.0.0.1:50002:t
      - ELECTRUM_CONFIG_AUTO_CONNECT=false # must be disabled if "oneserver" := true
      - ELECTRUM_CONFIG_CONFIRMED_ONLY=false
    volumes:
      - ./.data:/home/electrum/.electrum:z
    healthcheck:
      test: [ "CMD", "electrum", "--regtest", "getinfo" ]
      interval: 3s
      retries: 20
